generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// User Model - Authentication
// ============================================
model User {
  id            String   @id @default(cuid())
  email         String   @unique @db.VarChar(255)
  passwordHash  String   @db.VarChar(255)
  name          String?  @db.VarChar(255)
  role          String   @default("admin") @db.VarChar(50) // admin, editor vb.
  createdAt     DateTime @default(now()) @db.Timestamptz(3)
  updatedAt     DateTime @updatedAt @db.Timestamptz(3)

  @@index([email])
  @@map("users")
}

// ============================================
// Report Status Enum
// ============================================
enum ReportStatus {
  PENDING
  IN_REVIEW
  RESOLVED
  REJECTED
}

// ============================================
// Report Type Enum
// ============================================
enum ReportType {
  WRONG_INFO
  TYPO
  IMAGE_ISSUE
  OTHER
}

// ============================================
// Social Platform Enum
// ============================================
enum SocialPlatform {
  INSTAGRAM
  TWITTER
  YOUTUBE
  TIKTOK
  FACEBOOK
  LINKEDIN
  WEBSITE
  IMDB
  SPOTIFY
}

// ============================================
// Category Model - Flexible categorization
// ============================================
model Category {
  id          String   @id @default(cuid())
  name        String   @unique @db.VarChar(100)
  slug        String   @unique @db.VarChar(100)
  description String?  @db.Text
  createdAt   DateTime @default(now()) @db.Timestamptz(3)
  updatedAt   DateTime @updatedAt @db.Timestamptz(3)

  // Many-to-Many relationship
  celebrities Celebrity[]

  @@index([name])
  @@index([slug])
  @@map("categories")
}

// ============================================
// Celebrity Model - Main entity
// ============================================
model Celebrity {
  id          String   @id @default(cuid())
  name        String   @db.VarChar(255)
  nickname    String?  @db.VarChar(255)
  profession  String?  @db.VarChar(255)
  birthDate   DateTime?
  birthPlace  String?  @db.VarChar(255)
  nationality String?  @db.VarChar(10)
  zodiac      String?  @db.VarChar(20) // aries, taurus, vb
  bio         String?  @db.Text
  image       String?  @db.VarChar(1000) // @deprecated - Use images relation instead. Kept for backward compatibility.
  slug        String   @unique @db.VarChar(300)
  createdAt   DateTime @default(now()) @db.Timestamptz(3)
  updatedAt   DateTime @updatedAt @db.Timestamptz(3)

  // Many-to-Many relationship (Implicit)
  categories       Category[]

  // One-to-Many relationship with Celebrity Images (max 3)
  images CelebrityImage[]

  // One-to-Many relationship with FAQs
  faqs FAQ[]

  // One-to-Many relationship with Social Media Links
  socialMediaLinks SocialMediaLink[]

  // One-to-Many relationship with Reports
  reports Report[]

  // Performance indexes
  @@index([name])
  @@index([profession])
  @@index([nationality])
  @@index([zodiac]) // Filtreleme performansı için index ekledik
  @@index([createdAt(sort: Desc)])
  @@index([slug])

  @@map("celebrities")
}

// ============================================
// Celebrity Image Model - Multi-image support (max 3)
// ============================================
model CelebrityImage {
  id           String   @id @default(cuid())
  url          String   @db.VarChar(1000)
  isMain       Boolean  @default(false)
  displayOrder Int      @default(0)
  createdAt    DateTime @default(now()) @db.Timestamptz(3)
  updatedAt    DateTime @updatedAt @db.Timestamptz(3)

  // Relation to Celebrity
  celebrityId String
  celebrity   Celebrity @relation(fields: [celebrityId], references: [id], onDelete: Cascade)

  @@index([celebrityId])
  @@index([isMain])
  @@index([displayOrder])
  @@map("celebrity_images")
}

// ============================================
// FAQ Model - Frequently Asked Questions for SEO
// ============================================
model FAQ {
  id           String   @id @default(cuid())
  question     String   @db.VarChar(500)
  answer       String   @db.Text
  displayOrder Int      @default(0)
  createdAt    DateTime @default(now()) @db.Timestamptz(3)
  updatedAt    DateTime @updatedAt @db.Timestamptz(3)

  // Relation to Celebrity
  celebrityId String
  celebrity   Celebrity @relation(fields: [celebrityId], references: [id], onDelete: Cascade)

  @@index([celebrityId])
  @@index([displayOrder])
  @@map("faqs")
}

// ============================================
// Social Media Link Model
// ============================================
model SocialMediaLink {
  id           String         @id @default(cuid())
  platform     SocialPlatform
  url          String         @db.VarChar(500)
  displayOrder Int            @default(0)
  createdAt    DateTime       @default(now()) @db.Timestamptz(3)
  updatedAt    DateTime       @updatedAt @db.Timestamptz(3)

  // Relation to Celebrity
  celebrityId  String
  celebrity    Celebrity      @relation(fields: [celebrityId], references: [id], onDelete: Cascade)

  @@index([celebrityId])
  @@index([platform])
  @@map("social_media_links")
}

// ============================================
// Report Model - User feedback for content errors
// ============================================
model Report {
  id           String       @id @default(cuid())
  celebrityId  String
  celebrity    Celebrity    @relation(fields: [celebrityId], references: [id], onDelete: Cascade)
  type         ReportType   @default(WRONG_INFO)
  message      String       @db.VarChar(1000)
  contactEmail String?      @db.VarChar(255)
  status       ReportStatus @default(PENDING)
  ipAddress    String?      @db.VarChar(45)
  createdAt    DateTime     @default(now()) @db.Timestamptz(3)
  updatedAt    DateTime     @updatedAt @db.Timestamptz(3)

  @@index([celebrityId])
  @@index([status])
  @@index([createdAt(sort: Desc)])
  @@map("reports")
}